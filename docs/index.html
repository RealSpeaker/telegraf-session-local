<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="LocalSession.html">LocalSession</a><ul class='methods'><li data-type='method'><a href="LocalSession.html#getSessionKey">getSessionKey</a></li><li data-type='method'><a href="LocalSession.html#getSession">getSession</a></li><li data-type='method'><a href="LocalSession.html#saveSession">saveSession</a></li><li data-type='method'><a href="LocalSession.html#middleware">middleware</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-telegraf-session-local.html">telegraf-session-local</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LocalSession.storagefileSync">LocalSession.storagefileSync</a></li><li><a href="global.html#LocalSession.storagefileAsync">LocalSession.storagefileAsync</a></li><li><a href="global.html#LocalSession.storageMemory">LocalSession.storageMemory</a></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><p><a href="https://www.npmjs.com/package/telegraf-session-local"><img src="https://img.shields.io/npm/v/telegraf-session-local.svg?style=flat-square" alt="NPM Version"></a><br><a href="https://www.npmjs.com/package/telegraf-session-local"><img src="https://img.shields.io/node/v/telegraf-session-local.svg?style=flat-square" alt="node"></a><br><a href="https://travis-ci.org/RealSpeaker/telegraf-session-local"><img src="https://travis-ci.org/RealSpeaker/telegraf-session-local.svg?branch=master" alt="Build Status"></a><br><a href="https://coveralls.io/github/RealSpeaker/telegraf-session-local?branch=master"><img src="https://coveralls.io/repos/github/RealSpeaker/telegraf-session-local/badge.svg?branch=master" alt="Coverage Status"></a><br><a href="https://david-dm.org/realspeaker/telegraf-session-local"><img src="https://david-dm.org/realspeaker/telegraf-session-local.svg" alt="Dependency Status"></a><br><a href="http://standardjs.com/"><img src="https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat-square" alt="js-standard-style"></a><br><a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/RealSpeaker/telegraf-session-local.svg" alt="Greenkeeper badge"></a></p>
<h1><a href="https://github.com/telegraf/telegraf">Telegraf</a> local sessions middleware</h1><p>Multiple types of storage supported: <code>Memory</code>, <code>fileSync</code>, <code>fileAsync</code>, ...</p>
<p>Multiple file formats supported: <code>JSON</code>, <code>BSON</code>, <code>YAML</code>, <code>XML</code>, ...</p>
<h2>ðŸš€ Installation</h2><pre class="prettyprint source lang-js"><code>$ npm install telegraf-session-local -S</code></pre><h3><a href="http://realspeaker.github.io/telegraf-session-local/">Documentation &amp; reference</a></h3><h2>ðŸ‘€ Quick-start example</h2><pre class="prettyprint source lang-js"><code>const
  Telegraf = require('telegraf'),
  LocalSession = require('telegraf-session-local')

const Bot = new Telegraf(process.env.BOT_TOKEN)

Bot.use((new LocalSession({ database: 'example_db.json' })).middleware())

Bot.on('text', (ctx, next) => {
  ctx.session.counter = ctx.session.counter || 0
  ctx.session.counter++
  return next()
})

Bot.command('/stats', (ctx) => {
  ctx.replyWithMarkdown(`Database has \`${ctx.session.counter}\` messages from @${ctx.from.username}`)
})

Bot.command('/remove', (ctx) => {
  ctx.replyWithMarkdown(`Removing session from database: \`${JSON.stringify(ctx.session)}\``)
  // Setting session to null, undefined or empty object/array will trigger removing it from database
  ctx.session = null
})

Bot.startPolling()</code></pre><h2>ðŸ’¡ Full example</h2><pre class="prettyprint source lang-js"><code>const
  Telegraf = require('telegraf'),
  LocalSession = require('telegraf-session-local')

const Bot = new Telegraf(process.env.BOT_TOKEN)

// Name of session property object in Telegraf Context (default: 'session')
const property = 'data'

const localSession = new LocalSession({
  // Database name/path, where sessions will be located (default: 'sessions.json')
  database: 'example_db.json',
  // Name of session property object in Telegraf Context (default: 'session')
  property: 'session',
  // Type of lowdb storage (default: 'storagefileAsync')
  storage: LocalSession.storagefileAsync,
  // Format of storage/database (default: JSON.stringify / JSON.parse)
  format: {
    serialize: (obj) => JSON.stringify(obj, null, 2), // null & 2 for pretty-formatted JSON
    deserialize: (str) => JSON.parse(str),
  },
  // We will use `messages` array in our database to store user messages using exported lowdb instance from LocalSession via Telegraf Context
  state: { messages: [] }
})

// Telegraf will use `telegraf-session-local` configured above middleware with overrided `property` name
Bot.use(localSession.middleware(property))

Bot.on('text', (ctx, next) => {
  ctx[property].counter = ctx[property].counter || 0
  ctx[property].counter++
  // Writing message to Array `messages` into database which already has sessions Array
  ctx[property + 'DB'].get('messages').push([ctx.message]).write()
  // `property`+'DB' is a name of property which contains lowdb instance (`dataDB`)

  return next()
})

Bot.command('/stats', (ctx) => {
  let msg = `Using session object from [Telegraf Context](http://telegraf.js.org/context.html) (\`ctx\`), named \`${property}\`\n`
     msg += `Database has \`${ctx[property].counter}\` messages from @${ctx.from.username}`
  ctx.replyWithMarkdown(msg)
})
Bot.command('/remove', (ctx) => {
  ctx.replyWithMarkdown(`Removing session from database: \`${JSON.stringify(ctx[property])}\``)
  // Setting session to null, undefined or empty object/array will trigger removing it from database
  ctx[property] = null
})

Bot.startPolling()</code></pre><h4>Another examples located in <code>/examples</code> folder</h4><p>Also, you may read comments in  <code>/lib/session.js</code></p>
<h2>ðŸŽ“ Licence &amp; copyright</h2><p>&copy; 2017 Tema Smirnov / <a href="&#x6d;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#x67;&#x69;&#116;&#104;&#x75;&#x62;&#46;&#116;&#101;&#x6d;&#97;&#x40;&#x73;&#109;&#x69;&#114;&#x6e;&#x6f;&#x76;&#46;&#111;&#110;&#101;">&#x67;&#x69;&#116;&#104;&#x75;&#x62;&#46;&#116;&#101;&#x6d;&#97;&#x40;&#x73;&#109;&#x69;&#114;&#x6e;&#x6f;&#x76;&#46;&#111;&#110;&#101;</a> / <a href="https://goo.gl/YeV4gk"><img src="https://img.shields.io/badge/%F0%9F%92%AC%20Telegram-%40TemaSM-blue.svg" alt="Telegram"></a></p>
<p>MIT - <a href="https://github.com/RealSpeaker">RealSpeaker Group Ltd.</a></p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>